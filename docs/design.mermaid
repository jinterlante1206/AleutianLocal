
graph TD
    %% --- Styling ---
    classDef host fill:#e1f5fe,stroke:#01579b,stroke-width:2px,color:#000;
    classDef core fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px,color:#000;
    classDef storage fill:#fff3e0,stroke:#ef6c00,stroke-width:2px,color:#000;
    classDef obs fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000;
    classDef external fill:#fafafa,stroke:#9e9e9e,stroke-width:2px,stroke-dasharray: 5 5,color:#000;

    subgraph Host_Machine ["ğŸ’» Host Machine (Mac/Linux"]
        CLI["Aleutian CLI User Terminal"]:::host
        Browser["Web Browser Dashboards/UI"]:::host
        Ollama["ğŸ¦™ Ollama / Local LLM Port 11434"]:::host

        subgraph Podman_Network ["ğŸ³ Aleutian Container Network (aleutian-network"]
            
            %% --- Core Services ---
            Orch["âš™ï¸ Orchestrator (Go<br/>Port: 12210"]:::core
            RAG["ğŸ§  RAG Engine (Python<br/>Port: 8000"]:::core
            Embed["ğŸ”  Embedding Server Sentence Transformers<br/>Port: 8000"]:::core
            GGUF["ğŸ“¦ GGUF Converter<br/>Port: 8000"]:::core

            %% --- Storage ---
            Weaviate["ğŸ—„ï¸ Weaviate DB Vector Store<br/>Port: 8080"]:::storage

            %% --- Observability Stack ---
            OTel["ğŸ“¡ OTel Collector Telemetry Aggregator"]:::obs
            Jaeger["Unk Jaeger Tracing UI"]:::obs
            Prom["ğŸ“ˆ Prometheus Metrics DB"]:::obs
            Grafana["ğŸ“Š Grafana Visualizations"]:::obs
        end
    end

    subgraph External_Cloud ["â˜ï¸ External Cloud"]
        OpenAI["OpenAI / Anthropic API"]:::external
        HuggingFace["Hugging Face Hub"]:::external
    end

    %% --- Data Flows ---

    %% 1. User Interaction
    CLI -->|HTTP /v1/documents Ingestion| Orch
    CLI -->|HTTP /v1/ask Query| Orch
    Browser -->|View Traces<br/>:16686| Jaeger
    Browser -->|View Metrics<br/>:3000| Grafana

    %% 2. Orchestration Logic
    Orch -->|gRPC/HTTP| Weaviate
    Orch -->|Start RAG Pipeline| RAG
    Orch -->|Generate Vectors| Embed

    %% 3. RAG & AI Logic
    RAG -->|Search & Retrieve| Weaviate
    RAG -->|Vectorize Query| Embed
    RAG -->|Inference Request| Ollama
    RAG -->|Inference Request| OpenAI

    %% 4. Utilities
    CLI -->|aleutian convert| GGUF
    GGUF -->|Download Model| HuggingFace
    GGUF -->|Save Model| Ollama

    %% 5. Observability Pipeline (Telemetry
    Orch -.->|Traces/Metrics| OTel
    RAG -.->|Traces/Metrics| OTel
    Embed -.->|Traces/Metrics| OTel
    
    OTel -->|Export Traces| Jaeger
    OTel -->|Export Metrics| Prom
    Grafana -->|Query| Prom
    Grafana -->|Query| Jaeger